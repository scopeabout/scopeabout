<h1>Sign Up</h1>

<%= form_with(model: @user, local: true, multipart: true) do |form| %>
    <% if @user.errors.any? %>
        <div id="error_explanation">
          <ul>
            <% @user.errors.full_messages.each do |message| %>
                <li><%= message %></li>
            <% end %>
          </ul>
        </div>
    <% end %>

    <div class="form-group">
      <%= label(:user, :email) %>
      <%= text_field(:user, :email, class: 'form-control', type: 'email', placeholder: 'Your email address.') %>
    </div>

    <div class="form-group">
      <%= label(:user, :name) %>
      <%= text_field(:user, :name, class: 'form-control', placeholder: 'This is visible to public.') %>
    </div>

    <div class="form-group">
      <%= label(:user, :password) %>
      <%= password_field 'user', 'password', class: 'form-control', placeholder: 'Minimum of 4 letters.' %>
    </div>

    <div class="form-group">
      <%= label(:user, :password_confirm) %>
      <%= password_field 'user', 'password_confirmation', class: 'form-control', placeholder: 'Re-type the above password.' %>
    </div>

    <div class="form-group">
      <label for="user_avatar_file">Profile Photo</label>
      <input id="avatar_file" class="form-control-file" accept="image/png,image/gif,image/jpeg" aria-describedby="fileHelp" type="file">
      <%= form.hidden_field 'avatar', id: 'avatar_upload', value: ''%>
      <small id="fileHelp" class="form-text text-muted">Provide an image that contains your face. Make sure the image is
        a square.
      </small>
    </div>

    <div class="form-group">
      <%= label(:user, :interests) %>
      <%= text_area(:user, :interests, class: 'form-control', placeholder: 'e.g: running skidiving') %>
      <small class="form-text text-muted">Give a list of interests you like in words seperated with spaces. (minimum
        of 3 and maximum of 10 words).
      </small>
    </div>

    <div class="form-group">
      <%= label(:user, :description) %>
      <%= text_area(:user, :description, class: 'form-control', placeholder: 'Tell us something about yourself (optional)') %>
    </div>

    <div class="actions">
      <%= form.submit 'Sign Up', class: 'btn btn-outline-primary' %>
    </div>
<% end %>

<script>
    function blobToDataURL(blob, callback) {
        var a = new FileReader();
        a.onload = function (e) {
            callback(e.target.result);
        }
        a.readAsDataURL(blob);
    }

    document.getElementById('avatar_file').onchange = function (evt) {
        ImageTools.resize(this.files[0], {
            width: 1200, // maximum width
            height: 1200 // maximum height
        }, function (blob, didItResize) {
            // didItResize will be true if it managed to resize it, otherwise false (and will return the original file as 'blob')
            blobToDataURL(blob, function(data) {
                document.getElementById('avatar_upload').value = data;
            });
        });
    };
</script>
